<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>百家樂分析器 (DG 燒牌版)</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
  h1 { text-align: center; }
  .section { margin-bottom: 20px; }
  input { width: 50px; margin-right: 5px; }
  button { margin-right: 10px; padding: 5px 10px; }
  select { padding: 5px; }
  .result { margin-top: 10px; font-weight: bold; }
</style>
</head>
<body>
<h1>百家樂分析器 (DG 燒牌版)</h1>

<div class="section">
  <h3>輸入本局牌（1=A，11/12/13=J/Q/K，空格表示未補牌）</h3>
  <div>
    閒家: <input type="number" id="player1" min="1" max="13">
          <input type="number" id="player2" min="1" max="13">
          <input type="number" id="player3" min="1" max="13">
  </div>
  <div>
    莊家: <input type="number" id="banker1" min="1" max="13">
          <input type="number" id="banker2" min="1" max="13">
          <input type="number" id="banker3" min="1" max="13">
  </div>
</div>

<div class="section">
  <h3>燒牌（翻第一張牌作為燒牌）</h3>
  <button id="burnCardBtn">翻開第一張牌燒牌</button>
  <div class="result" id="burnCard">尚未燒牌</div>
</div>

<div class="section">
  <h3>上一局結果（第一局可不選）</h3>
  <select id="lastResult">
    <option value="">第一局可不選</option>
    <option value="banker">莊家勝</option>
    <option value="player">閒家勝</option>
    <option value="tie">和局</option>
  </select>
</div>

<div class="section">
  <button id="calculate">計算累計期望值</button>
  <button id="shuffle">洗牌 / 重新計算</button>
</div>

<div class="section">
  <div class="result" id="expectation">累計期望值：0</div>
  <div class="result" id="recommendation">推薦下注：-</div>
</div>

<script>
let totalExpectation = 0;
let deck = []; // 剩餘牌堆
let burnCount = 0;

// 初始化 8 副牌
function initDeck() {
  deck = [];
  for(let i=0;i<8;i++){
    for(let j=1;j<=13;j++){
      deck.push(j);
    }
  }
}

// 將輸入牌轉為數字，空格或無效視為0
function convertCard(val) {
  val = parseInt(val);
  if (isNaN(val) || val < 1 || val > 13) return 0;
  return val;
}

// DG 燒牌規則
function burnCard() {
  if(deck.length===0) return 0;
  let firstCard = deck[0];
  let count = firstCard;
  if(firstCard > 10) count = 10; // J/Q/K=10
  // 從牌堆移除燒掉的牌
  deck.splice(0, count);
  burnCount = count;
  document.getElementById("burnCard").textContent = "燒牌數：" + burnCount + "（翻開牌：" + firstCard + "）";
}

// 計算期望值
function calculateExpectation(playerCards, bankerCards, lastResult) {
  // 扣掉輸入的牌
  [...playerCards,...bankerCards].forEach(c=>{
    let index = deck.indexOf(c);
    if(index>=0) deck.splice(index,1);
  });

  let expectation = 0;
  if (!lastResult) {
    // 第一局，用簡單理論概率示範
    expectation = 0.05; 
  } else {
    if (lastResult === "banker") expectation = 1.06;
    else if (lastResult === "player") expectation = 0.94;
    else if (lastResult === "tie") expectation = 0;
  }
  return expectation;
}

// 推薦下注
function recommendNext(totalExpectation) {
  if (totalExpectation > 0) return "莊家";
  else if (totalExpectation < 0) return "閒家";
  else return "-";
}

// 初始化牌堆
initDeck();

document.getElementById("burnCardBtn").addEventListener("click", () => {
  burnCard();
});

document.getElementById("calculate").addEventListener("click", () => {
  let playerCards = [
    convertCard(document.getElementById("player1").value),
    convertCard(document.getElementById("player2").value),
    convertCard(document.getElementById("player3").value)
  ];
  let bankerCards = [
    convertCard(document.getElementById("banker1").value),
    convertCard(document.getElementById("banker2").value),
    convertCard(document.getElementById("banker3").value)
  ];
  let lastResult = document.getElementById("lastResult").value;

  let expectation = calculateExpectation(playerCards, bankerCards, lastResult);
  totalExpectation += expectation;

  document.getElementById("expectation").textContent = "累計期望值：" + totalExpectation.toFixed(2);
  document.getElementById("recommendation").textContent = "推薦下注：" + recommendNext(totalExpectation);
});

document.getElementById("shuffle").addEventListener("click", () => {
  totalExpectation = 0;
  document.getElementById("player1").value = "";
  document.getElementById("player2").value = "";
  document.getElementById("player3").value = "";
  document.getElementById("banker1").value = "";
  document.getElementById("banker2").value = "";
  document.getElementById("banker3").value = "";
  document.getElementById("lastResult").value = "";
  document.getElementById("burnCard").textContent = "尚未燒牌";
  document.getElementById("expectation").textContent = "累計期望值：0";
  document.getElementById("recommendation").textContent = "推薦下注：-";
  initDeck();
});
</script>

</body>
</html>
