<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>百家樂分析器（DG 手動燒牌版）</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: auto;
    padding: 20px;
  }
  h1 {
    text-align: center;
  }
  .section {
    margin-bottom: 20px;
  }
  input, select, button {
    padding: 6px;
    margin: 4px 2px;
  }
  input {
    width: 55px;
  }
  button {
    cursor: pointer;
  }
  .result {
    margin-top: 10px;
    font-weight: bold;
  }
</style>
</head>

<body>

<h1>百家樂分析器（DG 手動燒牌）</h1>

<div class="section">
  <h3>燒牌（只在第一局設定）</h3>
  <input type="number" id="burnInput" min="1" max="13" placeholder="1-13">
  <button id="setBurnBtn">設定燒牌</button>
  <div class="result" id="burnInfo">尚未設定燒牌</div>
</div>

<div class="section">
  <h3>本局開牌（1=A，11/12/13=J/Q/K）</h3>
  <div>
    閒：
    <input id="p1" type="number" min="1" max="13">
    <input id="p2" type="number" min="1" max="13">
    <input id="p3" type="number" min="1" max="13">
  </div>
  <div>
    莊：
    <input id="b1" type="number" min="1" max="13">
    <input id="b2" type="number" min="1" max="13">
    <input id="b3" type="number" min="1" max="13">
  </div>
</div>

<div class="section">
  <h3>上一局結果（第一局可不選）</h3>
  <select id="lastResult">
    <option value="">第一局</option>
    <option value="banker">莊贏</option>
    <option value="player">閒贏</option>
    <option value="tie">和局</option>
  </select>
</div>

<div class="section">
  <button id="calcBtn">計算</button>
  <button id="shuffleBtn">洗牌 / 重置</button>
</div>

<div class="section">
  <div class="result" id="evText">累計期望值：0</div>
  <div class="result" id="recText">推薦下注：-</div>
</div>

<script>
let deck = [];
let totalEV = 0;
let burned = false;

// 初始化 8 副牌
function initDeck() {
  deck = [];
  for (let i = 0; i < 8; i++) {
    for (let j = 1; j <= 13; j++) {
      deck.push(j);
    }
  }
  deck.sort(() => Math.random() - 0.5);
}

// 轉換輸入
function cardVal(v) {
  let n = parseInt(v);
  if (isNaN(n) || n < 1 || n > 13) return null;
  return n;
}

// 設定燒牌（只執行一次）
document.getElementById("setBurnBtn").onclick = () => {
  if (burned) {
    alert("燒牌已設定，洗牌後才能重新設定");
    return;
  }
  let burn = parseInt(document.getElementById("burnInput").value);
  if (isNaN(burn) || burn < 1 || burn > 13) {
    alert("請輸入 1~13");
    return;
  }
  deck.splice(0, burn);
  burned = true;
  document.getElementById("burnInfo").textContent = "燒牌張數：" + burn;
};

// 計算
document.getElementById("calcBtn").onclick = () => {

  let cards = [
    cardVal(p1.value), cardVal(p2.value), cardVal(p3.value),
    cardVal(b1.value), cardVal(b2.value), cardVal(b3.value)
  ].filter(v => v !== null);

  // 從牌堆移除已出現的牌
  cards.forEach(c => {
    let idx = deck.indexOf(c);
    if (idx >= 0) deck.splice(idx, 1);
  });

  let last = document.getElementById("lastResult").value;

  // 期望值（示意，之後可升級）
  let ev = 0;
  if (last === "banker") ev = 1;
  else if (last === "player") ev = -1;
  else ev = 0;

  totalEV += ev;

  document.getElementById("evText").textContent =
    "累計期望值：" + totalEV.toFixed(2);

  document.getElementById("recText").textContent =
    totalEV > 0 ? "推薦下注：莊" :
    totalEV < 0 ? "推薦下注：閒" : "推薦下注：-";

  // ⭐ 自動清空本局輸入
  p1.value = p2.value = p3.value = "";
  b1.value = b2.value = b3.value = "";
};

// 洗牌
document.getElementById("shuffleBtn").onclick = () => {
  initDeck();
  totalEV = 0;
  burned = false;
  document.getElementById("burnInput").value = "";
  document.getElementById("burnInfo").textContent = "尚未設定燒牌";
  document.getElementById("evText").textContent = "累計期望值：0";
  document.getElementById("recText").textContent = "推薦下注：-";
};

initDeck();
</script>

</body>
</html>
